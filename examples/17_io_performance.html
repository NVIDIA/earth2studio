
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/favicon.ico" rel="icon" type="image/x-icon">
    <title>IO Backend Performance &#8212; Earth2Studio 0.12.0a0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/nvidia-sphinx-theme.css?v=a9229f12" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=1e1bc2a1"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=1ae7504c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/17_io_performance';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/NVIDIA/earth2studio/gh-pages/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'main';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Ensemble Forecasting with Downscaling" href="18_ensemble_downscaling.html" />
    <link rel="prev" title="CBottle Super Resolution" href="16_cbottle_super_resolution.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.12" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/NVIDIA-Logo-V-ForScreen-ForLightBG.png" class="logo__image only-light" alt=""/>
    <img src="../_static/NVIDIA-Logo-V-ForScreen-ForDarkBG.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">Earth2Studio</p>
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../userguide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../modules/index.html">
    API
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NVIDIA/earth2studio/tree/main/recipes">
    Recipes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NVIDIA/earth2studio/blob/main/CHANGELOG.md">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NVIDIA/earth2studio" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../userguide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../modules/index.html">
    API
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NVIDIA/earth2studio/tree/main/recipes">
    Recipes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NVIDIA/earth2studio/blob/main/CHANGELOG.md">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NVIDIA/earth2studio" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_deterministic_workflow.html">Running Deterministic Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_diagnostic_workflow.html">Running Diagnostic Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_ensemble_workflow.html">Running Ensemble Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_corrdiff_inference.html">Generative Downscaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_ensemble_workflow_extend.html">Single Variable Perturbation Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_model_perturbation_hook.html">Model Hook Injection: Perturbation</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_seasonal_statistics.html">Statistical Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_distributed_manager.html">Distributed Manager Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_stormcast_example.html">Running StormCast Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_stormcast_ensemble_example.html">Running StormCast Ensemble Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_huge_ensembles.html">Huge Ensembles (HENS) Checkpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_temporal_interpolation.html">Temporal Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_cyclone_tracking.html">Tropical Cyclone Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_dlesym_example.html">Running DLESyM Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_cbottle_generation.html">CBottle Data Generation and Infilling</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_cbottle_super_resolution.html">CBottle Super Resolution</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">IO Backend Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="18_ensemble_downscaling.html">Ensemble Forecasting with Downscaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="19_local_datasource.html">Creating a Local Data Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="20_stormscope_goes_example.html">StormScope Satellite and Radar Nowcasting</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="extend/index.html">Extending Earth2Studio</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="extend/01_custom_prognostic.html">Extending Prognostic Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="extend/02_custom_diagnostic.html">Extending Diagnostic Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="extend/03_custom_datasource.html">Extending Data Sources</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">IO Backend Performance</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-17-io-performance-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="io-backend-performance">
<span id="sphx-glr-examples-17-io-performance-py"></span><h1>IO Backend Performance<a class="headerlink" href="#io-backend-performance" title="Link to this heading">#</a></h1>
<p>Leverage different IO backends for storing inference results.</p>
<p>This example explores IO backends inside Earth2Studio and how they can be used to write
data to different formats / locations. The IO is a core part of any inference pipeline
and depending on the desired target, can dramatically impact performance. This example
will help navigate users through the use of different IO backend APIs in a simple
workflow.</p>
<p>In this example you will learn:</p>
<ul class="simple">
<li><p>Initializing, creating arrays and writing with the Zarr IO backend</p></li>
<li><p>Initializing, creating arrays and writing with the NetCDF IO backend</p></li>
<li><p>Initializing and writing with the Asynchronous Non-blocking Zarr IO backend</p></li>
<li><p>Discussing performance implications and strategies that can be used</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># /// script</span>
<span class="c1"># dependencies = [</span>
<span class="c1">#   &quot;earth2studio[dlwp] @ git+https://github.com/NVIDIA/earth2studio.git&quot;,</span>
<span class="c1">#   &quot;matplotlib&quot;,</span>
<span class="c1"># ]</span>
<span class="c1"># ///</span>
</pre></div>
</div>
<section id="set-up">
<h2>Set Up<a class="headerlink" href="#set-up" title="Link to this heading">#</a></h2>
<p>To demonstrate different IO, this example will use a simple ensemble workflow that we
will manually create ourselves. One could use the built in workflow in Earth2Studio
however, this will allow us to better understand the APIs.</p>
<p>We need the following components:</p>
<ul class="simple">
<li><p>Datasource: Pull data from the GFS data api <a class="reference internal" href="../modules/generated/data/earth2studio.data.GFS.html#earth2studio.data.GFS" title="earth2studio.data.GFS"><code class="xref py py-class docutils literal notranslate"><span class="pre">earth2studio.data.GFS</span></code></a>.</p></li>
<li><p>Prognostic Model: Use the built in DLWP model <a class="reference internal" href="../modules/generated/models/px/earth2studio.models.px.DLWP.html#earth2studio.models.px.DLWP" title="earth2studio.models.px.DLWP"><code class="xref py py-class docutils literal notranslate"><span class="pre">earth2studio.models.px.DLWP</span></code></a>.</p></li>
<li><p>Perturbation Method: Use the standard Gaussian method <a class="reference internal" href="../modules/generated/perturbation/earth2studio.perturbation.Gaussian.html#earth2studio.perturbation.Gaussian" title="earth2studio.perturbation.Gaussian"><code class="xref py py-class docutils literal notranslate"><span class="pre">earth2studio.perturbation.Gaussian</span></code></a>.</p></li>
<li><p>IO Backends: Use a few IO Backends including <a class="reference internal" href="../modules/generated/io/earth2studio.io.AsyncZarrBackend.html#earth2studio.io.AsyncZarrBackend" title="earth2studio.io.AsyncZarrBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">earth2studio.io.AsyncZarrBackend</span></code></a>, <a class="reference internal" href="../modules/generated/io/earth2studio.io.NetCDF4Backend.html#earth2studio.io.NetCDF4Backend" title="earth2studio.io.NetCDF4Backend"><code class="xref py py-class docutils literal notranslate"><span class="pre">earth2studio.io.NetCDF4Backend</span></code></a> and <a class="reference internal" href="../modules/generated/io/earth2studio.io.ZarrBackend.html#earth2studio.io.ZarrBackend" title="earth2studio.io.ZarrBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">earth2studio.io.ZarrBackend</span></code></a>.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="n">load_dotenv</span><span class="p">()</span>  <span class="c1"># TODO: make common example prep function</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">earth2studio.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">GFS</span><span class="p">,</span> <span class="n">DataSource</span><span class="p">,</span> <span class="n">fetch_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">earth2studio.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncZarrBackend</span><span class="p">,</span> <span class="n">IOBackend</span><span class="p">,</span> <span class="n">NetCDF4Backend</span><span class="p">,</span> <span class="n">ZarrBackend</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">earth2studio.models.px</span><span class="w"> </span><span class="kn">import</span> <span class="n">DLWP</span><span class="p">,</span> <span class="n">PrognosticModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">earth2studio.perturbation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gaussian</span><span class="p">,</span> <span class="n">Perturbation</span>

<span class="c1"># Get the device</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

<span class="c1"># Load the cBottle data source</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">DLWP</span><span class="o">.</span><span class="n">load_default_package</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">DLWP</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Create the ERA5 data source</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">GFS</span><span class="p">()</span>

<span class="c1"># Create perturbation method</span>
<span class="n">pt</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="creating-a-simple-ensemble-workflow">
<h2>Creating a Simple Ensemble Workflow<a class="headerlink" href="#creating-a-simple-ensemble-workflow" title="Link to this heading">#</a></h2>
<p>Start with creating a simple ensemble inference workflow. This is essentially a
simpler version of the built in ensemble workflow <a class="reference internal" href="../modules/generated/workflows/earth2studio.run.ensemble.html#earth2studio.run.ensemble" title="earth2studio.run.ensemble"><code class="xref py py-meth docutils literal notranslate"><span class="pre">earth2studio.run.ensemble()</span></code></a>.
In this case, this is for an ensemble inference workflow that will predict a 5 day
forecast for Christmas 2022. Following standard Earth2Studio practices, the function
accepts initialized prognostic, data source, io backend and perturbation method.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">earth2studio.utils.coords</span><span class="w"> </span><span class="kn">import</span> <span class="n">map_coords</span><span class="p">,</span> <span class="n">split_coords</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">earth2studio.utils.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_time_array</span>

<span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Assuming 6-hour time steps</span>


<span class="k">def</span><span class="w"> </span><span class="nf">christmas_five_day_ensemble</span><span class="p">(</span>
    <span class="n">times</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">datetime</span><span class="p">],</span>
    <span class="n">nsteps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">prognostic</span><span class="p">:</span> <span class="n">PrognosticModel</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataSource</span><span class="p">,</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">IOBackend</span><span class="p">,</span>
    <span class="n">perturbation</span><span class="p">:</span> <span class="n">Perturbation</span><span class="p">,</span>
    <span class="n">nensemble</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensemble inference example&quot;&quot;&quot;</span>
    <span class="c1"># ==========================================</span>
    <span class="c1"># Fetch Initialization Data</span>
    <span class="n">prognostic_ic</span> <span class="o">=</span> <span class="n">prognostic</span><span class="o">.</span><span class="n">input_coords</span><span class="p">()</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">to_time_array</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">coords0</span> <span class="o">=</span> <span class="n">fetch_data</span><span class="p">(</span>
        <span class="n">source</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="n">times</span><span class="p">,</span>
        <span class="n">variable</span><span class="o">=</span><span class="n">prognostic_ic</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">],</span>
        <span class="n">lead_time</span><span class="o">=</span><span class="n">prognostic_ic</span><span class="p">[</span><span class="s2">&quot;lead_time&quot;</span><span class="p">],</span>
        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># ==========================================</span>
    <span class="c1"># ==========================================</span>
    <span class="c1"># Set up IO backend by pre-allocating arrays (not needed for AsyncZarrBackend)</span>
    <span class="n">total_coords</span> <span class="o">=</span> <span class="n">prognostic</span><span class="o">.</span><span class="n">output_coords</span><span class="p">(</span><span class="n">prognostic</span><span class="o">.</span><span class="n">input_coords</span><span class="p">())</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;batch&quot;</span> <span class="ow">in</span> <span class="n">total_coords</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">total_coords</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]</span>
    <span class="n">total_coords</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>
    <span class="n">total_coords</span><span class="p">[</span><span class="s2">&quot;lead_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">prognostic</span><span class="o">.</span><span class="n">output_coords</span><span class="p">(</span><span class="n">prognostic</span><span class="o">.</span><span class="n">input_coords</span><span class="p">())[</span><span class="s2">&quot;lead_time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">total_coords</span><span class="o">.</span><span class="n">move_to_end</span><span class="p">(</span><span class="s2">&quot;lead_time&quot;</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">total_coords</span><span class="o">.</span><span class="n">move_to_end</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">total_coords</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ensemble&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nensemble</span><span class="p">)}</span> <span class="o">|</span> <span class="n">total_coords</span>

    <span class="n">variables_to_save</span> <span class="o">=</span> <span class="n">total_coords</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">add_array</span><span class="p">(</span><span class="n">total_coords</span><span class="p">,</span> <span class="n">variables_to_save</span><span class="p">)</span>
    <span class="c1"># ==========================================</span>
    <span class="c1"># ==========================================</span>
    <span class="c1"># Run inference</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ensemble&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nensemble</span><span class="p">)}</span> <span class="o">|</span> <span class="n">coords0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">nensemble</span><span class="p">,</span> <span class="o">*</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>

    <span class="c1"># Map lat and lon if needed</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">map_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">prognostic_ic</span><span class="p">)</span>

    <span class="c1"># Perturb ensemble</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">perturbation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>

    <span class="c1"># Create prognostic iterator</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">prognostic</span><span class="o">.</span><span class="n">create_iterator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="n">total</span><span class="o">=</span><span class="n">nsteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Running batch inference&quot;</span><span class="p">,</span>
        <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
            <span class="c1"># Dump result to IO, split_coords separates variables to different arrays</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">map_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;tcwv&quot;</span><span class="p">])})</span>
            <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">*</span><span class="n">split_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coords</span><span class="p">))</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="n">nsteps</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="c1"># ==========================================</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_folder_size</span><span class="p">(</span><span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get folder size in megabytes&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>

    <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">total_size</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="local-storage-zarr-io">
<h2>Local Storage Zarr IO<a class="headerlink" href="#local-storage-zarr-io" title="Link to this heading">#</a></h2>
<p>As a base line, lets run the Zarr IO backend saving it to local disk.
Local IO storage is typically preferred since we can then access the data after the
inference pipeline is finished using standard libraries.
Chunking play an important role on performance, both with respect to compression and
also when accessing data.
Here we will chunk the output data based on time and lead_time</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">io</span> <span class="o">=</span> <span class="n">ZarrBackend</span><span class="p">(</span>
    <span class="s2">&quot;outputs/17_io_sync.zarr&quot;</span><span class="p">,</span>
    <span class="n">chunks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;lead_time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="n">backend_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;overwrite&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">christmas_five_day_ensemble</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="n">zarr_local_clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:56.506 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 209450878-718645

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:56.509 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 295463736-857297

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:56.511 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 422682974-1171397

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:56.513 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 251866913-804464

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:56.515 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 399402626-989950

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:56.517 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 410101849-875378

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:56.519 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 330483332-833835

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data:  14%|█▍        | 1/7 [00:00&lt;00:04,  1.48it/s]
Fetching GFS data:  86%|████████▌ | 6/7 [00:01&lt;00:00,  5.07it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:01&lt;00:00,  3.75it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:01&lt;00:00,  3.74it/s]

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:58.775 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 400334303-985030

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:58.778 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 410972364-870639

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:58.780 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 296814817-852960

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:58.782 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 253345828-804505

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:58.784 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 423575610-1170377

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:58.785 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 210327553-720496

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:56:58.788 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 331696727-829753

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data:  14%|█▍        | 1/7 [00:00&lt;00:02,  2.00it/s]
Fetching GFS data:  29%|██▊       | 2/7 [00:00&lt;00:01,  3.21it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00,  9.18it/s]


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]

Running batch inference:   5%|▍         | 1/21 [00:00&lt;00:11,  1.72it/s]

Running batch inference:  10%|▉         | 2/21 [00:01&lt;00:11,  1.71it/s]

Running batch inference:  14%|█▍        | 3/21 [00:01&lt;00:10,  1.73it/s]

Running batch inference:  19%|█▉        | 4/21 [00:02&lt;00:09,  1.71it/s]

Running batch inference:  24%|██▍       | 5/21 [00:02&lt;00:09,  1.73it/s]

Running batch inference:  29%|██▊       | 6/21 [00:03&lt;00:08,  1.73it/s]

Running batch inference:  33%|███▎      | 7/21 [00:04&lt;00:07,  1.78it/s]

Running batch inference:  38%|███▊      | 8/21 [00:04&lt;00:07,  1.77it/s]

Running batch inference:  43%|████▎     | 9/21 [00:05&lt;00:06,  1.75it/s]

Running batch inference:  48%|████▊     | 10/21 [00:05&lt;00:06,  1.73it/s]

Running batch inference:  52%|█████▏    | 11/21 [00:06&lt;00:05,  1.73it/s]

Running batch inference:  57%|█████▋    | 12/21 [00:06&lt;00:05,  1.71it/s]

Running batch inference:  62%|██████▏   | 13/21 [00:07&lt;00:04,  1.72it/s]

Running batch inference:  67%|██████▋   | 14/21 [00:08&lt;00:04,  1.71it/s]

Running batch inference:  71%|███████▏  | 15/21 [00:08&lt;00:03,  1.70it/s]

Running batch inference:  76%|███████▌  | 16/21 [00:09&lt;00:02,  1.70it/s]

Running batch inference:  81%|████████  | 17/21 [00:09&lt;00:02,  1.71it/s]

Running batch inference:  86%|████████▌ | 18/21 [00:10&lt;00:01,  1.71it/s]

Running batch inference:  90%|█████████ | 19/21 [00:10&lt;00:01,  1.74it/s]

Running batch inference:  95%|█████████▌| 20/21 [00:11&lt;00:00,  1.73it/s]

Running batch inference: 100%|██████████| 21/21 [00:12&lt;00:00,  1.74it/s]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Local zarr store inference time: </span><span class="si">{</span><span class="n">zarr_local_clock</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Uncompressed zarr store size: </span><span class="si">{</span><span class="n">get_folder_size</span><span class="p">(</span><span class="s1">&#39;outputs/17_io_sync.zarr&#39;</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Local zarr store inference time: 20.08226776123047s
Uncompressed zarr store size: 1330.78 MB
</pre></div>
</div>
</section>
<section id="compressed-local-storage-zarr-io">
<h2>Compressed Local Storage Zarr IO<a class="headerlink" href="#compressed-local-storage-zarr-io" title="Link to this heading">#</a></h2>
<p>By default the Zarr IO backends will be uncompressed.
In many instances this is fine, when data volumes are low.
However, in instances that we are writing a very large amount of data or the data
needs to get sent over the network to a remote store, compression is essential.
With the standard Zarr backend, this will cause a very noticeable slow down, but note
that the output store will be 3x smaller!</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">zarr</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">ZarrBackend</span><span class="p">(</span>
    <span class="s2">&quot;outputs/17_io_sync_compressed.zarr&quot;</span><span class="p">,</span>
    <span class="n">chunks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;lead_time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="n">backend_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;overwrite&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="n">zarr_codecs</span><span class="o">=</span><span class="n">zarr</span><span class="o">.</span><span class="n">codecs</span><span class="o">.</span><span class="n">BloscCodec</span><span class="p">(</span>
        <span class="n">cname</span><span class="o">=</span><span class="s2">&quot;zstd&quot;</span><span class="p">,</span> <span class="n">clevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">zarr</span><span class="o">.</span><span class="n">codecs</span><span class="o">.</span><span class="n">BloscShuffle</span><span class="o">.</span><span class="n">shuffle</span>
    <span class="p">),</span>  <span class="c1"># Zarrs default</span>
<span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">christmas_five_day_ensemble</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="n">zarr_local_clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:11.850 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 422682974-1171397

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:11.862 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 295463736-857297

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:11.873 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 209450878-718645

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:11.884 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 251866913-804464

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:11.896 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 330483332-833835

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:11.907 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 410101849-875378

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:11.918 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 399402626-989950

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 87.74it/s]

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:12.004 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 423575610-1170377

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:12.016 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 210327553-720496

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:12.027 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 331696727-829753

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:12.038 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 400334303-985030

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:12.050 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 410972364-870639

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:12.061 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 296814817-852960

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:12.072 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 253345828-804505

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 88.02it/s]


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]

Running batch inference:   5%|▍         | 1/21 [00:00&lt;00:14,  1.36it/s]

Running batch inference:  10%|▉         | 2/21 [00:01&lt;00:16,  1.17it/s]

Running batch inference:  14%|█▍        | 3/21 [00:02&lt;00:16,  1.10it/s]

Running batch inference:  19%|█▉        | 4/21 [00:03&lt;00:15,  1.07it/s]

Running batch inference:  24%|██▍       | 5/21 [00:04&lt;00:15,  1.03it/s]

Running batch inference:  29%|██▊       | 6/21 [00:05&lt;00:14,  1.05it/s]

Running batch inference:  33%|███▎      | 7/21 [00:06&lt;00:13,  1.05it/s]

Running batch inference:  38%|███▊      | 8/21 [00:07&lt;00:12,  1.04it/s]

Running batch inference:  43%|████▎     | 9/21 [00:08&lt;00:11,  1.05it/s]

Running batch inference:  48%|████▊     | 10/21 [00:09&lt;00:10,  1.06it/s]

Running batch inference:  52%|█████▏    | 11/21 [00:10&lt;00:09,  1.05it/s]

Running batch inference:  57%|█████▋    | 12/21 [00:11&lt;00:08,  1.05it/s]

Running batch inference:  62%|██████▏   | 13/21 [00:12&lt;00:07,  1.04it/s]

Running batch inference:  67%|██████▋   | 14/21 [00:13&lt;00:06,  1.04it/s]

Running batch inference:  71%|███████▏  | 15/21 [00:14&lt;00:05,  1.03it/s]

Running batch inference:  76%|███████▌  | 16/21 [00:15&lt;00:04,  1.05it/s]

Running batch inference:  81%|████████  | 17/21 [00:16&lt;00:03,  1.05it/s]

Running batch inference:  86%|████████▌ | 18/21 [00:17&lt;00:02,  1.05it/s]

Running batch inference:  90%|█████████ | 19/21 [00:17&lt;00:01,  1.05it/s]

Running batch inference:  95%|█████████▌| 20/21 [00:18&lt;00:00,  1.04it/s]

Running batch inference: 100%|██████████| 21/21 [00:19&lt;00:00,  1.04it/s]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Local compressed zarr store inference time: </span><span class="si">{</span><span class="n">zarr_local_clock</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Compressed zarr store size: </span><span class="si">{</span><span class="n">get_folder_size</span><span class="p">(</span><span class="s1">&#39;outputs/17_io_sync_compressed.zarr&#39;</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Local compressed zarr store inference time: 20.331928968429565s
Compressed zarr store size: 394.36 MB
</pre></div>
</div>
</section>
<section id="local-storage-netcdf-io">
<h2>Local Storage NetCDF IO<a class="headerlink" href="#local-storage-netcdf-io" title="Link to this heading">#</a></h2>
<p>NetCDF offers a similar user experience but saves the output into a single netCDF
file.
For local storage, NetCDF it typically preferred since it keeps all outputs into
a single file.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">io</span> <span class="o">=</span> <span class="n">NetCDF4Backend</span><span class="p">(</span><span class="s2">&quot;outputs/17_io_sync.nc&quot;</span><span class="p">,</span> <span class="n">backend_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">})</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">christmas_five_day_ensemble</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="n">nc_local_clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.184 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 410101849-875378

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.196 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 330483332-833835

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.207 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 422682974-1171397

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.218 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 399402626-989950

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.229 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 251866913-804464

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.240 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 295463736-857297

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.252 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 209450878-718645

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 88.35it/s]

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.336 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 423575610-1170377

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.348 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 253345828-804505

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.359 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 210327553-720496

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.371 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 331696727-829753

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.382 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 410972364-870639

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.393 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 400334303-985030

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:32.404 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 296814817-852960

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 89.15it/s]


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]

Running batch inference:   5%|▍         | 1/21 [00:00&lt;00:16,  1.20it/s]

Running batch inference:  19%|█▉        | 4/21 [00:00&lt;00:03,  5.35it/s]

Running batch inference:  38%|███▊      | 8/21 [00:01&lt;00:01, 10.79it/s]

Running batch inference:  57%|█████▋    | 12/21 [00:01&lt;00:00, 15.51it/s]

Running batch inference:  76%|███████▌  | 16/21 [00:01&lt;00:00, 19.44it/s]

Running batch inference:  95%|█████████▌| 20/21 [00:01&lt;00:00, 22.57it/s]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Local netcdf store inference time: </span><span class="si">{</span><span class="n">nc_local_clock</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Uncompressed zarr store size: </span><span class="si">{</span><span class="n">get_folder_size</span><span class="p">(</span><span class="s1">&#39;outputs/17_io_sync.nc&#39;</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Local netcdf store inference time: 1.8046724796295166s
Uncompressed zarr store size: 1330.79 MB
</pre></div>
</div>
</section>
<section id="in-memory-zarr-io">
<h2>In Memory Zarr IO<a class="headerlink" href="#in-memory-zarr-io" title="Link to this heading">#</a></h2>
<p>One way we can speed up IO is to save outputs to in-memory stores.
In-memory stores more limited in size depending on the hardware being used.
Also one needs to be careful with in memory stores, once the Python object is deleted
the data is gone.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">io</span> <span class="o">=</span> <span class="n">ZarrBackend</span><span class="p">(</span>
    <span class="n">chunks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;lead_time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">backend_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;overwrite&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>  <span class="c1"># Not path = in memory for Zarr</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">christmas_five_day_ensemble</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="n">zarr_memory_clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:33.996 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 330483332-833835

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.008 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 422682974-1171397

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.019 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 399402626-989950

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.030 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 251866913-804464

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.041 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 295463736-857297

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.053 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 209450878-718645

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.064 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 410101849-875378

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 88.70it/s]

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.148 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 410972364-870639

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.159 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 331696727-829753

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.170 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 400334303-985030

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.181 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 423575610-1170377

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.192 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 253345828-804505

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.203 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 296814817-852960

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:34.215 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 210327553-720496

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 89.59it/s]


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]

Running batch inference:   5%|▍         | 1/21 [00:00&lt;00:09,  2.15it/s]

Running batch inference:  10%|▉         | 2/21 [00:00&lt;00:08,  2.14it/s]

Running batch inference:  14%|█▍        | 3/21 [00:01&lt;00:08,  2.18it/s]

Running batch inference:  19%|█▉        | 4/21 [00:01&lt;00:07,  2.17it/s]

Running batch inference:  24%|██▍       | 5/21 [00:02&lt;00:07,  2.20it/s]

Running batch inference:  29%|██▊       | 6/21 [00:02&lt;00:06,  2.18it/s]

Running batch inference:  33%|███▎      | 7/21 [00:03&lt;00:06,  2.20it/s]

Running batch inference:  38%|███▊      | 8/21 [00:03&lt;00:05,  2.18it/s]

Running batch inference:  43%|████▎     | 9/21 [00:04&lt;00:05,  2.20it/s]

Running batch inference:  48%|████▊     | 10/21 [00:04&lt;00:05,  2.19it/s]

Running batch inference:  52%|█████▏    | 11/21 [00:05&lt;00:04,  2.21it/s]

Running batch inference:  57%|█████▋    | 12/21 [00:05&lt;00:04,  2.19it/s]

Running batch inference:  62%|██████▏   | 13/21 [00:05&lt;00:03,  2.20it/s]

Running batch inference:  67%|██████▋   | 14/21 [00:06&lt;00:03,  2.18it/s]

Running batch inference:  71%|███████▏  | 15/21 [00:06&lt;00:02,  2.19it/s]

Running batch inference:  76%|███████▌  | 16/21 [00:07&lt;00:02,  2.18it/s]

Running batch inference:  81%|████████  | 17/21 [00:07&lt;00:01,  2.19it/s]

Running batch inference:  86%|████████▌ | 18/21 [00:08&lt;00:01,  2.18it/s]

Running batch inference:  90%|█████████ | 19/21 [00:08&lt;00:00,  2.20it/s]

Running batch inference:  95%|█████████▌| 20/21 [00:09&lt;00:00,  2.19it/s]

Running batch inference: 100%|██████████| 21/21 [00:09&lt;00:00,  2.20it/s]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">In memory zarr store inference time: </span><span class="si">{</span><span class="n">zarr_memory_clock</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>In memory zarr store inference time: 9.938282251358032s
</pre></div>
</div>
</section>
<section id="compressed-local-async-zarr-io">
<h2>Compressed Local Async Zarr IO<a class="headerlink" href="#compressed-local-async-zarr-io" title="Link to this heading">#</a></h2>
<p>The async Zarr IO backend is an advanced IO backend designed to offer async
Zarr 3.0 writes to in-memory, local and remote data stores.
This data source is ideal when large volumes of data are needed to be written and
the users want to mask the IO with the forward execution of the model.</p>
<p>Because this IO backend relies on both async and multi-threading, it has a different
initialization pattern than others.
The main difference being that this backend does not use the add_array API, rather
users specify <cite>parallel_coords</cite> in the constructor that denote coords that slices will
be written to during inference.
Typically this might be <cite>time</cite>, <cite>lead_time</cite> and <cite>ensemble</cite>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">parallel_coords</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">),</span>
    <span class="s2">&quot;lead_time&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span>
    <span class="p">),</span>
<span class="p">}</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">AsyncZarrBackend</span><span class="p">(</span>
    <span class="s2">&quot;outputs/17_io_async.zarr&quot;</span><span class="p">,</span>
    <span class="n">parallel_coords</span><span class="o">=</span><span class="n">parallel_coords</span><span class="p">,</span>
    <span class="n">zarr_codecs</span><span class="o">=</span><span class="n">zarr</span><span class="o">.</span><span class="n">codecs</span><span class="o">.</span><span class="n">BloscCodec</span><span class="p">(</span>
        <span class="n">cname</span><span class="o">=</span><span class="s2">&quot;zstd&quot;</span><span class="p">,</span> <span class="n">clevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">zarr</span><span class="o">.</span><span class="n">codecs</span><span class="o">.</span><span class="n">BloscShuffle</span><span class="o">.</span><span class="n">shuffle</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">christmas_five_day_ensemble</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="n">zarr_async_clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2026-01-22 19:57:43.855 | DEBUG    | earth2studio.io.async_zarr:__init__:145 - Setting up Zarr object pool of size 1, may take a bit

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:43.956 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 251866913-804464

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:43.968 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 422682974-1171397

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:43.979 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 209450878-718645

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:43.990 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 330483332-833835

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.001 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 399402626-989950

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.012 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 410101849-875378

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.023 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 295463736-857297

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 88.53it/s]

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.116 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 410972364-870639

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.128 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 331696727-829753

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.139 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 423575610-1170377

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.150 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 400334303-985030

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.162 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 296814817-852960

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.173 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 210327553-720496

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:44.184 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 253345828-804505

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 88.33it/s]


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:44.222 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array ensemble to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:44.227 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array time to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:44.232 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array lead_time to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:44.235 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array lat to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:44.238 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array lon to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:44.242 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:323 - Initializing array t2m with shape (8, 1, 21, 721, 1440) with chunks (8, 1, 1, 721, 1440) dtype &lt;class &#39;numpy.float32&#39;&gt;


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:44.246 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:323 - Initializing array tcwv with shape (8, 1, 21, 721, 1440) with chunks (8, 1, 1, 721, 1440) dtype &lt;class &#39;numpy.float32&#39;&gt;


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:44.289 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]

Running batch inference:   5%|▍         | 1/21 [00:00&lt;00:04,  4.99it/s]


2026-01-22 19:57:44.476 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:   5%|▍         | 1/21 [00:00&lt;00:04,  4.99it/s]

Running batch inference:  10%|▉         | 2/21 [00:00&lt;00:04,  3.96it/s]


2026-01-22 19:57:44.783 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  10%|▉         | 2/21 [00:00&lt;00:04,  3.96it/s]

Running batch inference:  14%|█▍        | 3/21 [00:00&lt;00:04,  3.62it/s]


2026-01-22 19:57:45.141 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  14%|█▍        | 3/21 [00:00&lt;00:04,  3.62it/s]

Running batch inference:  19%|█▉        | 4/21 [00:01&lt;00:05,  3.14it/s]


2026-01-22 19:57:45.467 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  19%|█▉        | 4/21 [00:01&lt;00:05,  3.14it/s]

Running batch inference:  24%|██▍       | 5/21 [00:01&lt;00:05,  3.05it/s]


2026-01-22 19:57:45.813 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  24%|██▍       | 5/21 [00:01&lt;00:05,  3.05it/s]

Running batch inference:  29%|██▊       | 6/21 [00:01&lt;00:05,  2.99it/s]


2026-01-22 19:57:46.154 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  29%|██▊       | 6/21 [00:01&lt;00:05,  2.99it/s]

Running batch inference:  33%|███▎      | 7/21 [00:02&lt;00:04,  3.00it/s]


2026-01-22 19:57:46.529 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  33%|███▎      | 7/21 [00:02&lt;00:04,  3.00it/s]

Running batch inference:  38%|███▊      | 8/21 [00:02&lt;00:04,  2.83it/s]


2026-01-22 19:57:46.856 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  38%|███▊      | 8/21 [00:02&lt;00:04,  2.83it/s]

Running batch inference:  43%|████▎     | 9/21 [00:02&lt;00:03,  3.07it/s]


2026-01-22 19:57:47.175 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  43%|████▎     | 9/21 [00:02&lt;00:03,  3.07it/s]

Running batch inference:  48%|████▊     | 10/21 [00:03&lt;00:03,  3.00it/s]


2026-01-22 19:57:47.481 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  48%|████▊     | 10/21 [00:03&lt;00:03,  3.00it/s]

Running batch inference:  52%|█████▏    | 11/21 [00:03&lt;00:03,  3.15it/s]


2026-01-22 19:57:47.803 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  52%|█████▏    | 11/21 [00:03&lt;00:03,  3.15it/s]

Running batch inference:  57%|█████▋    | 12/21 [00:03&lt;00:02,  3.13it/s]


2026-01-22 19:57:48.091 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  57%|█████▋    | 12/21 [00:03&lt;00:02,  3.13it/s]

Running batch inference:  62%|██████▏   | 13/21 [00:04&lt;00:02,  3.12it/s]


2026-01-22 19:57:48.437 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  62%|██████▏   | 13/21 [00:04&lt;00:02,  3.12it/s]

Running batch inference:  67%|██████▋   | 14/21 [00:04&lt;00:02,  3.16it/s]


2026-01-22 19:57:48.723 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  67%|██████▋   | 14/21 [00:04&lt;00:02,  3.16it/s]

Running batch inference:  71%|███████▏  | 15/21 [00:04&lt;00:01,  3.22it/s]


2026-01-22 19:57:49.053 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  71%|███████▏  | 15/21 [00:04&lt;00:01,  3.22it/s]

Running batch inference:  76%|███████▌  | 16/21 [00:05&lt;00:01,  3.14it/s]


2026-01-22 19:57:49.358 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  76%|███████▌  | 16/21 [00:05&lt;00:01,  3.14it/s]

Running batch inference:  81%|████████  | 17/21 [00:05&lt;00:01,  3.23it/s]


2026-01-22 19:57:49.672 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  81%|████████  | 17/21 [00:05&lt;00:01,  3.23it/s]

Running batch inference:  86%|████████▌ | 18/21 [00:05&lt;00:00,  3.18it/s]


2026-01-22 19:57:49.973 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  86%|████████▌ | 18/21 [00:05&lt;00:00,  3.18it/s]

Running batch inference:  90%|█████████ | 19/21 [00:06&lt;00:00,  3.12it/s]


2026-01-22 19:57:50.349 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  90%|█████████ | 19/21 [00:06&lt;00:00,  3.12it/s]

Running batch inference:  95%|█████████▌| 20/21 [00:06&lt;00:00,  2.96it/s]


2026-01-22 19:57:50.671 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  95%|█████████▌| 20/21 [00:06&lt;00:00,  2.96it/s]

Running batch inference: 100%|██████████| 21/21 [00:06&lt;00:00,  3.05it/s]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Async zarr store inference time: </span><span class="si">{</span><span class="n">zarr_async_clock</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Compressed async zarr store size: </span><span class="si">{</span><span class="n">get_folder_size</span><span class="p">(</span><span class="s1">&#39;outputs/17_io_async.zarr&#39;</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Async zarr store inference time: 7.056309938430786s
Compressed async zarr store size: 394.35 MB
</pre></div>
</div>
</section>
<section id="compressed-local-non-blocking-async-zarr-io">
<h2>Compressed Local Non-Blocking Async Zarr IO<a class="headerlink" href="#compressed-local-non-blocking-async-zarr-io" title="Link to this heading">#</a></h2>
<p>That was faster than the normal Zarr method, even the uncompressed version making it
comparable to NetCDF, but we can still improve with this IO backend.
A unique feature of this particular backend is running in non-blocking mode, namely
IO writes will be placed onto other threads.
Users do need to be careful with this to both ensure data is not mutated while the IO
backend is working to move the data off the GPU, but also to make sure to wait for
write threads to finish before the object is deleted.</p>
<p>Note that this backend allows Zarr to be comparable to uncompressed NetCDF even 3x
compression!</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">io</span> <span class="o">=</span> <span class="n">AsyncZarrBackend</span><span class="p">(</span>
    <span class="s2">&quot;outputs/17_io_nonblocking_async.zarr&quot;</span><span class="p">,</span>
    <span class="n">parallel_coords</span><span class="o">=</span><span class="n">parallel_coords</span><span class="p">,</span>
    <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">zarr_codecs</span><span class="o">=</span><span class="n">zarr</span><span class="o">.</span><span class="n">codecs</span><span class="o">.</span><span class="n">BloscCodec</span><span class="p">(</span>
        <span class="n">cname</span><span class="o">=</span><span class="s2">&quot;zstd&quot;</span><span class="p">,</span> <span class="n">clevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">zarr</span><span class="o">.</span><span class="n">codecs</span><span class="o">.</span><span class="n">BloscShuffle</span><span class="o">.</span><span class="n">shuffle</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">christmas_five_day_ensemble</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="c1"># IMPORTANT: Make sure to call close to ensure IO backend threads have finished!</span>
<span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">zarr_nonblocking_async_clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2026-01-22 19:57:50.940 | DEBUG    | earth2studio.io.async_zarr:__init__:145 - Setting up Zarr object pool of size 8, may take a bit

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.037 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 251866913-804464

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.049 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 422682974-1171397

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.060 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 209450878-718645

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.071 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 330483332-833835

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.082 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 410101849-875378

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.094 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 399402626-989950

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.105 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 295463736-857297

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 88.44it/s]

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.194 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 331696727-829753

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.206 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 423575610-1170377

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.217 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 400334303-985030

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.229 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 296814817-852960

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.240 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 210327553-720496

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.251 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 253345828-804505

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:57:51.262 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 410972364-870639

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 88.89it/s]


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:51.299 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array ensemble to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:51.304 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array time to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:51.308 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array lead_time to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:51.312 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array lat to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:51.316 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:289 - Writing coordinate array lon to zarr store


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:51.319 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:323 - Initializing array t2m with shape (8, 1, 21, 721, 1440) with chunks (8, 1, 1, 721, 1440) dtype &lt;class &#39;numpy.float32&#39;&gt;


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:51.321 | DEBUG    | earth2studio.io.async_zarr:_initialize_arrays:323 - Initializing array tcwv with shape (8, 1, 21, 721, 1440) with chunks (8, 1, 1, 721, 1440) dtype &lt;class &#39;numpy.float32&#39;&gt;


Running batch inference:   0%|          | 0/21 [00:00&lt;?, ?it/s]


2026-01-22 19:57:51.363 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:   5%|▍         | 1/21 [00:00&lt;00:01, 15.18it/s]

Running batch inference:  10%|▉         | 2/21 [00:00&lt;00:00, 19.46it/s]


2026-01-22 19:57:51.434 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  10%|▉         | 2/21 [00:00&lt;00:00, 19.46it/s]


2026-01-22 19:57:51.499 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  14%|█▍        | 3/21 [00:00&lt;00:00, 19.46it/s]

Running batch inference:  19%|█▉        | 4/21 [00:00&lt;00:01, 15.87it/s]


2026-01-22 19:57:51.576 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  19%|█▉        | 4/21 [00:00&lt;00:01, 15.87it/s]


2026-01-22 19:57:51.631 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  24%|██▍       | 5/21 [00:00&lt;00:01, 15.87it/s]

Running batch inference:  29%|██▊       | 6/21 [00:00&lt;00:00, 15.51it/s]


2026-01-22 19:57:51.716 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  29%|██▊       | 6/21 [00:00&lt;00:00, 15.51it/s]


2026-01-22 19:57:51.772 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  33%|███▎      | 7/21 [00:00&lt;00:00, 15.51it/s]

Running batch inference:  38%|███▊      | 8/21 [00:00&lt;00:00, 14.81it/s]


2026-01-22 19:57:51.863 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  38%|███▊      | 8/21 [00:00&lt;00:00, 14.81it/s]


2026-01-22 19:57:51.904 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  43%|████▎     | 9/21 [00:00&lt;00:00, 14.81it/s]

Running batch inference:  48%|████▊     | 10/21 [00:01&lt;00:02,  5.12it/s]


2026-01-22 19:57:52.698 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  48%|████▊     | 10/21 [00:01&lt;00:02,  5.12it/s]


2026-01-22 19:57:52.736 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  52%|█████▏    | 11/21 [00:01&lt;00:01,  5.12it/s]

Running batch inference:  57%|█████▋    | 12/21 [00:01&lt;00:01,  6.77it/s]


2026-01-22 19:57:52.821 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  57%|█████▋    | 12/21 [00:01&lt;00:01,  6.77it/s]


2026-01-22 19:57:52.856 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  62%|██████▏   | 13/21 [00:01&lt;00:01,  6.77it/s]

Running batch inference:  67%|██████▋   | 14/21 [00:01&lt;00:00,  8.38it/s]


2026-01-22 19:57:52.919 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  67%|██████▋   | 14/21 [00:01&lt;00:00,  8.38it/s]


2026-01-22 19:57:52.955 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  71%|███████▏  | 15/21 [00:01&lt;00:00,  8.38it/s]

Running batch inference:  76%|███████▌  | 16/21 [00:01&lt;00:00, 10.20it/s]


2026-01-22 19:57:53.022 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  76%|███████▌  | 16/21 [00:01&lt;00:00, 10.20it/s]


2026-01-22 19:57:53.055 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  81%|████████  | 17/21 [00:01&lt;00:00, 10.20it/s]


2026-01-22 19:57:53.133 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  86%|████████▌ | 18/21 [00:01&lt;00:00, 10.20it/s]

Running batch inference:  90%|█████████ | 19/21 [00:01&lt;00:00, 12.84it/s]


2026-01-22 19:57:53.193 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  90%|█████████ | 19/21 [00:01&lt;00:00, 12.84it/s]


2026-01-22 19:57:53.277 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  95%|█████████▌| 20/21 [00:01&lt;00:00, 12.84it/s]

Running batch inference: 100%|██████████| 21/21 [00:01&lt;00:00, 13.13it/s]

                                                                        2026-01-22 19:57:53.289 | DEBUG    | earth2studio.io.async_zarr:_limit_pool_size:458 - In IO thread pool throttle, limiting
2026-01-22 19:57:53.316 | DEBUG    | earth2studio.io.async_zarr:_limit_pool_size:458 - In IO thread pool throttle, limiting
2026-01-22 19:57:53.331 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays
2026-01-22 19:57:53.401 | DEBUG    | earth2studio.io.async_zarr:_limit_pool_size:458 - In IO thread pool throttle, limiting
2026-01-22 19:57:53.427 | DEBUG    | earth2studio.io.async_zarr:_limit_pool_size:458 - In IO thread pool throttle, limiting
2026-01-22 19:57:53.528 | DEBUG    | earth2studio.io.async_zarr:_limit_pool_size:458 - In IO thread pool throttle, limiting
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Non-blocking async zarr store inference time: </span><span class="si">{</span><span class="n">zarr_nonblocking_async_clock</span><span class="si">}</span><span class="s2">s&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Compressed non-blocking async zarr store size: </span><span class="si">{</span><span class="n">get_folder_size</span><span class="p">(</span><span class="s1">&#39;outputs/17_io_nonblocking_async.zarr&#39;</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Non-blocking async zarr store inference time: 2.629727363586426s
Compressed non-blocking async zarr store size: 394.37 MB
</pre></div>
</div>
</section>
<section id="remote-non-blocking-async-zarr-io">
<h2>Remote Non-Blocking Async Zarr IO<a class="headerlink" href="#remote-non-blocking-async-zarr-io" title="Link to this heading">#</a></h2>
<p>This IO backend can be further customized by changing the Fsspec Filesystem used by
the Zarr store which can be controlled via the <cite>fs_factory</cite> parameter.
Note that this is a factory method, the IO backend will need to create multiple
instances of the file system.
Some examples that may be of interest are:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">fsspec.implementations.local</span> <span class="pre">import</span> <span class="pre">LocalFileSystem</span></code> (Default, local store)</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">fsspec.implementations.memory</span> <span class="pre">import</span> <span class="pre">MemoryFileSystem</span></code> (in-memory store)</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">s3fs</span> <span class="pre">import</span> <span class="pre">S3FileSystem</span></code> (Remote S3 store)</p></li>
</ul>
<p>For sake of example, lets have a look at writing to a remote store would require.
Compression is a must in this instances, since we need to minimize the data transfer
over the network.
The file system factory is set to S3 with the appropiate credentials in a partial
callable object.
Lastly we can increase the max number of thread workers with the <cite>pool_size</cite> parameter
to further boost performance.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">s3fs</span>

<span class="k">if</span> <span class="s2">&quot;S3FS_KEY&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="s2">&quot;S3FS_SECRET&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="c1"># Remember, needs to be a callable</span>
    <span class="n">fs_factory</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
        <span class="n">s3fs</span><span class="o">.</span><span class="n">S3FileSystem</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;S3FS_KEY&quot;</span><span class="p">],</span>
        <span class="n">secret</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;S3FS_SECRET&quot;</span><span class="p">],</span>
        <span class="n">client_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;endpoint_url&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;S3FS_ENDPOINT&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)},</span>
        <span class="n">asynchronous</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">AsyncZarrBackend</span><span class="p">(</span>
        <span class="s2">&quot;earth2studio/ci/example/17_io_async.zarr&quot;</span><span class="p">,</span>
        <span class="n">parallel_coords</span><span class="o">=</span><span class="n">parallel_coords</span><span class="p">,</span>
        <span class="n">fs_factory</span><span class="o">=</span><span class="n">fs_factory</span><span class="p">,</span>
        <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">pool_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">zarr_codecs</span><span class="o">=</span><span class="n">zarr</span><span class="o">.</span><span class="n">codecs</span><span class="o">.</span><span class="n">BloscCodec</span><span class="p">(</span>
            <span class="n">cname</span><span class="o">=</span><span class="s2">&quot;zstd&quot;</span><span class="p">,</span> <span class="n">clevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">zarr</span><span class="o">.</span><span class="n">codecs</span><span class="o">.</span><span class="n">BloscShuffle</span><span class="o">.</span><span class="n">shuffle</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">christmas_five_day_ensemble</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="c1"># IMPORTANT: Make sure to call close to ensure IO backend threads have finished!</span>
    <span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># To clean up the zarr store you can use</span>
    <span class="c1"># fs = s3fs.S3FileSystem(</span>
    <span class="c1">#     key=os.environ[&quot;S3FS_KEY&quot;],</span>
    <span class="c1">#     secret=os.environ[&quot;S3FS_SECRET&quot;],</span>
    <span class="c1">#     client_kwargs={&quot;endpoint_url&quot;: os.environ.get(&quot;S3FS_ENDPOINT&quot;, None)},</span>
    <span class="c1"># )</span>
    <span class="c1"># fs.rm(&quot;earth2studio/ci/example/17_io_async.zarr&quot;, recursive=True)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2026-01-22 19:57:53.600 | DEBUG    | earth2studio.io.async_zarr:__init__:145 - Setting up Zarr object pool of size 16, may take a bit

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.597 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 410101849-875378

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.608 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 330483332-833835

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.619 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 399402626-989950

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.630 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 422682974-1171397

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.641 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 295463736-857297

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.653 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 209450878-718645

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.664 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221219/18/atmos/gfs.t18z.pgrb2.0p25.f000 251866913-804464

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 89.57it/s]

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.756 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 423575610-1170377

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.767 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 210327553-720496

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.778 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 331696727-829753

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.789 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 400334303-985030

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.800 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 410972364-870639

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.812 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 253345828-804505

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]

2026-01-22 19:58:21.822 | DEBUG    | earth2studio.data.gfs:fetch_array:382 - Fetching GFS grib file: noaa-gfs-bdp-pds/gfs.20221220/00/atmos/gfs.t00z.pgrb2.0p25.f000 296814817-852960

Fetching GFS data:   0%|          | 0/7 [00:00&lt;?, ?it/s]
Fetching GFS data: 100%|██████████| 7/7 [00:00&lt;00:00, 89.96it/s]


Running batch inference:   0%|          | 0/5 [00:00&lt;?, ?it/s]

Running batch inference:  20%|██        | 1/5 [00:02&lt;00:11,  2.95s/it]


2026-01-22 19:58:24.987 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  20%|██        | 1/5 [00:03&lt;00:11,  2.95s/it]

Running batch inference:  40%|████      | 2/5 [00:04&lt;00:06,  2.20s/it]


2026-01-22 19:58:26.789 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  40%|████      | 2/5 [00:04&lt;00:06,  2.20s/it]

Running batch inference:  60%|██████    | 3/5 [00:06&lt;00:04,  2.10s/it]


2026-01-22 19:58:28.628 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  60%|██████    | 3/5 [00:06&lt;00:04,  2.10s/it]

Running batch inference:  80%|████████  | 4/5 [00:08&lt;00:01,  1.87s/it]


2026-01-22 19:58:30.249 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays


Running batch inference:  80%|████████  | 4/5 [00:08&lt;00:01,  1.87s/it]

Running batch inference: 100%|██████████| 5/5 [00:10&lt;00:00,  1.94s/it]

                                                                      2026-01-22 19:58:32.052 | DEBUG    | earth2studio.io.async_zarr:_limit_pool_size:458 - In IO thread pool throttle, limiting
2026-01-22 19:58:32.191 | DEBUG    | earth2studio.io.async_zarr:_write:592 - Writing 1 chunks to 2 Zarr arrays
</pre></div>
</div>
</section>
<section id="post-processing">
<h2>Post-Processing<a class="headerlink" href="#post-processing" title="Link to this heading">#</a></h2>
<p>Lastly, we can plot the each of the local Zarr stores to verify that indeed they are
the same.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="c1"># Load the datasets</span>
<span class="n">ds_async</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="s2">&quot;outputs/17_io_async.zarr&quot;</span><span class="p">,</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ds_nonblocking</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span>
    <span class="s2">&quot;outputs/17_io_nonblocking_async.zarr&quot;</span><span class="p">,</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">ds_sync</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="s2">&quot;outputs/17_io_sync.zarr&quot;</span><span class="p">)</span>
<span class="n">ds_nc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s2">&quot;outputs/17_io_sync.nc&quot;</span><span class="p">)</span>

<span class="c1"># Create a 2x2 subplot grid</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Comparison of mean t2m across IO Backends&quot;</span><span class="p">)</span>

<span class="c1"># Plot t2m from each dataset</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">ds_async</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lead_time</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;ensemble&quot;</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">320</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Async Zarr&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">ds_nonblocking</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lead_time</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;ensemble&quot;</span><span class="p">),</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">320</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Non-blocking Async Zarr&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">ds_sync</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lead_time</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;ensemble&quot;</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">320</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sync Zarr&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">ds_nc</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lead_time</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;ensemble&quot;</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">320</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;NetCDF&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;outputs/17_io_performance.jpg&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_17_io_performance_001.png" srcset="../_images/sphx_glr_17_io_performance_001.png" alt="Comparison of mean t2m across IO Backends, Async Zarr, Non-blocking Async Zarr, Sync Zarr, NetCDF" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (1 minutes 47.759 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-17-io-performance-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b01dde9511148e62f7877606218cc4ff/17_io_performance.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">17_io_performance.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/fe3de2ab0237535694cf01d2914cc3c8/17_io_performance.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">17_io_performance.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/dca8748c8069991321575ce2ccfe8a47/17_io_performance.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">17_io_performance.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="16_cbottle_super_resolution.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CBottle Super Resolution</p>
      </div>
    </a>
    <a class="right-next"
       href="18_ensemble_downscaling.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Ensemble Forecasting with Downscaling</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up">Set Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-simple-ensemble-workflow">Creating a Simple Ensemble Workflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#local-storage-zarr-io">Local Storage Zarr IO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compressed-local-storage-zarr-io">Compressed Local Storage Zarr IO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#local-storage-netcdf-io">Local Storage NetCDF IO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-memory-zarr-io">In Memory Zarr IO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compressed-local-async-zarr-io">Compressed Local Async Zarr IO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compressed-local-non-blocking-async-zarr-io">Compressed Local Non-Blocking Async Zarr IO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remote-non-blocking-async-zarr-io">Remote Non-Blocking Async Zarr IO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#post-processing">Post-Processing</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/17_io_performance.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, NVIDIA.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>