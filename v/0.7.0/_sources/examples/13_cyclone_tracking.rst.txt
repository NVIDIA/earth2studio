
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/13_cyclone_tracking.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_examples_13_cyclone_tracking.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_13_cyclone_tracking.py:


Tropical Cyclone Tracking
=========================

Tropical cyclone tracking with tracker diagnostic models.

This example will demonstrate how to use the tropical cyclone (TC) tracker diagnostic
models for creating TC paths.
The diagnostics used here can be combined with other AI weather models and ensemble
methods to create complex inference workflow that enable downstream analysis.


In this example you will learn:

- How to instantiate a TC tracker diagnostic
- How to apply the TC tracker to data
- How to couple the TC tracker to a prognostic model
- Post-processing results

.. GENERATED FROM PYTHON SOURCE LINES 39-52

Set Up
------
This example will look at tracking cyclones during August 2009, a moment in time when
multiple tropical cyclones where impacting East Asia.
Earth2Studio provides multiple variations of TC trackers such as :py:class:`earth2studio.models.dx.TCTrackerVitart`
and :py:class:`earth2studio.models.dx.TCTrackerWuDuan`.
The difference being the underlying algorithm used to identify the center.

This example needs the following:

- Diagostic Model: Use the TC tracker :py:class:`earth2studio.models.dx.TCTrackerWuDuan`.
- Datasource: Pull data from the WB2 ERA5 data api :py:class:`earth2studio.data.WB2ERA5`.
- Prognostic Model: Use the built in FourCastNet Model :py:class:`earth2studio.models.px.FCN`.

.. GENERATED FROM PYTHON SOURCE LINES 54-83

.. code-block:: Python

    import os

    os.makedirs("outputs", exist_ok=True)
    from dotenv import load_dotenv

    load_dotenv()  # TODO: make common example prep function

    from datetime import datetime, timedelta

    import torch

    from earth2studio.data import ARCO
    from earth2studio.models.dx import TCTrackerWuDuan
    from earth2studio.models.px import SFNO
    from earth2studio.utils.time import to_time_array

    # Create tropical cyclone tracker
    tracker = TCTrackerWuDuan()

    # Load the default model package which downloads the check point from NGC
    package = SFNO.load_default_package()
    prognostic = SFNO.load_model(package)

    # Create the data source
    data = ARCO()

    nsteps = 16  # Number of steps to run the tracker for into future
    start_time = datetime(2009, 8, 5)  # Start date for inference








.. GENERATED FROM PYTHON SOURCE LINES 84-92

Tracking Analysis Data
----------------------
Before coupling the TC tracker with a prognostic model, we will first apply it to
analysis data.
We can fetch a small time range from the data source and provide it to our model.

For the forecast we will predict for two days (these will get executed as a batch) for
20 forecast steps which is 5 days.

.. GENERATED FROM PYTHON SOURCE LINES 94-111

.. code-block:: Python


    from earth2studio.data import fetch_data, prep_data_array

    device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")
    tracker = tracker.to(device)

    # Land fall occured August 25th 2017
    times = [start_time + timedelta(hours=6 * i) for i in range(nsteps + 1)]
    for step, time in enumerate(times):
        da = data(time, tracker.input_coords()["variable"])
        x, coords = prep_data_array(da, device=device)
        output, output_coords = tracker(x, coords)
        print(f"Step {step}: ARCO tracks output shape {output.shape}")

    era5_tracks = output.cpu()
    torch.save(era5_tracks, "era5.pt")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:15:53.813 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:15:53.814 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:15:53.815 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:15:53.816 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:15:53.818 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  20%|██        | 1/5 [00:00<00:00,  9.15it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 20.78it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 21.16it/s]
    Step 0: ARCO tracks output shape torch.Size([1, 7, 1, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.286 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-05T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.286 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-05T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.287 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-05T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.287 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-05T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.288 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-05T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 18.47it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 22.98it/s]
    Step 1: ARCO tracks output shape torch.Size([1, 7, 2, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.650 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-05T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.651 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-05T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.651 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-05T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.652 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-05T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:05.652 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-05T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 18.71it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 23.26it/s]
    Step 2: ARCO tracks output shape torch.Size([1, 7, 3, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.012 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-05T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.013 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-05T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.013 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-05T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.014 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-05T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.014 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-05T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 21.53it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 23.69it/s]
    Step 3: ARCO tracks output shape torch.Size([1, 8, 4, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.363 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-06T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.363 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-06T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.364 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-06T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.364 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-06T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.365 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-06T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 21.02it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 23.34it/s]
    Step 4: ARCO tracks output shape torch.Size([1, 9, 5, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.737 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-06T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.737 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-06T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.738 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-06T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.738 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-06T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:06.739 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-06T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 20.39it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 22.62it/s]
    Step 5: ARCO tracks output shape torch.Size([1, 10, 6, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.160 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-06T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.161 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-06T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.161 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-06T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.162 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-06T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.162 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-06T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 16.41it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 20.42it/s]
    Step 6: ARCO tracks output shape torch.Size([1, 11, 7, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.534 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-06T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.535 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-06T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.535 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-06T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.536 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-06T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.536 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-06T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 16.32it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 20.30it/s]
    Step 7: ARCO tracks output shape torch.Size([1, 12, 8, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.916 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-07T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.916 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-07T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.917 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-07T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.917 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-07T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:08.918 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-07T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 16.65it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 20.73it/s]
    Step 8: ARCO tracks output shape torch.Size([1, 13, 9, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.311 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-07T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.312 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-07T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.312 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-07T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.313 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-07T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.313 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-07T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 20.18it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 23.36it/s]
    Step 9: ARCO tracks output shape torch.Size([1, 14, 10, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.671 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-07T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.671 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-07T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.672 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-07T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.672 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-07T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:09.673 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-07T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 18.48it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 20.73it/s]
    Step 10: ARCO tracks output shape torch.Size([1, 15, 11, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.044 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-07T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.044 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-07T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.045 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-07T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.045 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-07T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.046 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-07T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 18.41it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 22.85it/s]
    Step 11: ARCO tracks output shape torch.Size([1, 16, 12, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.396 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-08T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.396 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-08T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.397 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-08T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.398 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-08T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:10.398 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-08T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 16.69it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 20.75it/s]
    Step 12: ARCO tracks output shape torch.Size([1, 17, 13, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.273 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-08T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.274 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-08T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.274 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-08T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.275 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-08T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.275 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-08T06:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 17.26it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 21.48it/s]
    Step 13: ARCO tracks output shape torch.Size([1, 18, 14, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.640 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-08T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.640 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-08T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.641 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-08T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.641 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-08T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.642 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-08T12:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 17.50it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 21.76it/s]
    Step 14: ARCO tracks output shape torch.Size([1, 19, 15, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.996 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-08T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.996 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-08T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.997 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-08T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.997 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-08T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:11.998 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-08T18:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 16.32it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 20.31it/s]
    Step 15: ARCO tracks output shape torch.Size([1, 20, 16, 4])
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:12.379 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-09T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:12.380 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-09T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:12.380 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-09T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:12.381 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-09T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]                                                             2025-05-21 02:16:12.381 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-09T00:00:00
    Fetching ARCO data:   0%|          | 0/5 [00:00<?, ?it/s]    Fetching ARCO data:  80%|████████  | 4/5 [00:00<00:00, 19.29it/s]    Fetching ARCO data: 100%|██████████| 5/5 [00:00<00:00, 21.52it/s]
    Step 16: ARCO tracks output shape torch.Size([1, 21, 17, 4])




.. GENERATED FROM PYTHON SOURCE LINES 112-121

Notice that the output tensor grows as iterations are performed.
This is because the tracker builds tracks based on previous forward passes returning
a tensor with the dimensions [batch, path, step, variable].
Not all paths are guaranteed to be the same length or have the same start / stop time
so any missing data is populated with a nan value.

Up next lets also repeat the same process using the prognostic AI model.
One could use one of the build in workflows but here we will manually implement the
inference loop.

.. GENERATED FROM PYTHON SOURCE LINES 123-159

.. code-block:: Python


    from tqdm import tqdm

    from earth2studio.utils.coords import map_coords

    prognostic = prognostic.to(device)
    # Reset the internal path buffer of tracker
    tracker.reset_path_buffer()

    # Load the initial state
    x, coords = fetch_data(
        source=data,
        time=to_time_array([start_time]),
        variable=prognostic.input_coords()["variable"],
        lead_time=prognostic.input_coords()["lead_time"],
        device=device,
    )

    # Create prognostic iterator
    model = prognostic.create_iterator(x, coords)
    with tqdm(total=nsteps + 1, desc="Running inference") as pbar:
        for step, (x, coords) in enumerate(model):
            # Run tracker
            x, coords = map_coords(x, coords, tracker.input_coords())
            output, output_coords = tracker(x, coords)
            # lets remove the lead time dim
            output = output[:, 0]
            print(f"Step {step}: SFNO tracks output shape {output.shape}")

            pbar.update(1)
            if step == nsteps:
                break

    sfno_tracks = output.cpu()
    torch.save(sfno_tracks, "sfno.pt")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.162 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u600 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.163 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t500 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.163 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q150 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.164 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z100 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.164 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t925 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.165 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u925 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.165 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t400 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.166 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z300 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.167 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t200 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.167 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q925 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.168 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u50 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.168 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v700 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.169 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v150 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.169 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q700 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.170 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v200 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.170 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z400 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.171 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u150 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.171 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u500 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.172 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z250 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.173 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z600 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.173 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t150 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.174 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: sp at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.175 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q250 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.175 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t700 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.176 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u1000 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.177 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t2m at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.177 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v500 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.178 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u300 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.179 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u400 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.179 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z925 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.179 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u850 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.180 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v300 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.180 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q600 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.181 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u700 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.181 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v600 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.182 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q400 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.182 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q200 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.183 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q1000 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.183 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: tcwv at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.184 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u250 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.184 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z50 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.185 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u10m at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.185 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v925 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.186 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v50 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.186 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q500 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.187 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v10m at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.187 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v1000 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.187 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v400 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.188 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t250 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.188 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u200 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.189 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t50 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.189 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z200 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.190 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v100 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.190 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z1000 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.191 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z150 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.191 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t300 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.192 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t100 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.192 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t600 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.193 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z700 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.193 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q50 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.194 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q300 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.194 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z850 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.195 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: msl at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.195 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t850 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.196 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u100m at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.197 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: t1000 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.197 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v100m at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.198 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v250 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.198 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q850 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.199 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: q100 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.199 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: z500 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.200 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: u100 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]                                                              2025-05-21 02:16:13.200 | DEBUG    | earth2studio.data.arco:fetch_array:252 - Fetching ARCO zarr array for variable: v850 at 2009-08-05T00:00:00
    Fetching ARCO data:   0%|          | 0/73 [00:00<?, ?it/s]    Fetching ARCO data:   1%|▏         | 1/73 [00:03<04:15,  3.54s/it]    Fetching ARCO data:   3%|▎         | 2/73 [00:03<02:01,  1.71s/it]    Fetching ARCO data:   4%|▍         | 3/73 [00:04<01:18,  1.11s/it]    Fetching ARCO data:  29%|██▉       | 21/73 [00:05<00:06,  7.71it/s]    Fetching ARCO data: 100%|██████████| 73/73 [00:05<00:00, 13.91it/s]
    Running inference:   0%|          | 0/17 [00:00<?, ?it/s]Step 0: SFNO tracks output shape torch.Size([1, 7, 1, 4])
    Running inference:   6%|▌         | 1/17 [00:00<00:02,  6.56it/s]Step 1: SFNO tracks output shape torch.Size([1, 8, 2, 4])
    Running inference:  12%|█▏        | 2/17 [00:00<00:06,  2.16it/s]Step 2: SFNO tracks output shape torch.Size([1, 8, 3, 4])
    Running inference:  18%|█▊        | 3/17 [00:01<00:07,  1.79it/s]Step 3: SFNO tracks output shape torch.Size([1, 9, 4, 4])
    Running inference:  24%|██▎       | 4/17 [00:02<00:07,  1.67it/s]Step 4: SFNO tracks output shape torch.Size([1, 10, 5, 4])
    Running inference:  29%|██▉       | 5/17 [00:02<00:07,  1.60it/s]Step 5: SFNO tracks output shape torch.Size([1, 10, 6, 4])
    Running inference:  35%|███▌      | 6/17 [00:03<00:07,  1.55it/s]Step 6: SFNO tracks output shape torch.Size([1, 10, 7, 4])
    Running inference:  41%|████      | 7/17 [00:04<00:06,  1.55it/s]Step 7: SFNO tracks output shape torch.Size([1, 11, 8, 4])
    Running inference:  47%|████▋     | 8/17 [00:04<00:05,  1.53it/s]Step 8: SFNO tracks output shape torch.Size([1, 12, 9, 4])
    Running inference:  53%|█████▎    | 9/17 [00:05<00:05,  1.51it/s]Step 9: SFNO tracks output shape torch.Size([1, 13, 10, 4])
    Running inference:  59%|█████▉    | 10/17 [00:06<00:04,  1.52it/s]Step 10: SFNO tracks output shape torch.Size([1, 14, 11, 4])
    Running inference:  65%|██████▍   | 11/17 [00:06<00:03,  1.53it/s]Step 11: SFNO tracks output shape torch.Size([1, 15, 12, 4])
    Running inference:  71%|███████   | 12/17 [00:07<00:03,  1.53it/s]Step 12: SFNO tracks output shape torch.Size([1, 16, 13, 4])
    Running inference:  76%|███████▋  | 13/17 [00:08<00:02,  1.52it/s]Step 13: SFNO tracks output shape torch.Size([1, 17, 14, 4])
    Running inference:  82%|████████▏ | 14/17 [00:08<00:01,  1.51it/s]Step 14: SFNO tracks output shape torch.Size([1, 18, 15, 4])
    Running inference:  88%|████████▊ | 15/17 [00:09<00:01,  1.53it/s]Step 15: SFNO tracks output shape torch.Size([1, 19, 16, 4])
    Running inference:  94%|█████████▍| 16/17 [00:10<00:00,  1.52it/s]Step 16: SFNO tracks output shape torch.Size([1, 20, 17, 4])
    Running inference: 100%|██████████| 17/17 [00:10<00:00,  1.51it/s]    Running inference: 100%|██████████| 17/17 [00:10<00:00,  1.58it/s]




.. GENERATED FROM PYTHON SOURCE LINES 160-172

Note that before the inference loop of the AI model, the path buffer of the tracker
was reset which refreshes the tracker's path state starting from scratch.
Otherwise, it would attempt to append to the existing tracks from the data source
loop in the previous section.

Finally we can plot the results to compare the track ground truths from ERA5 with
those produced by SFNO.
Recall the outputs of :py:class:`earth2studio.models.dx.TCTrackerWuDuan` has the path
ID in the second dimension, thus that is what will determine the number of lines.
The lat/lon coords are the first two variables in the last dimension.
Lastly we just need to be mindful of the NaN filler values which can get easily
masked out and any "path" that isnt over 2 points long

.. GENERATED FROM PYTHON SOURCE LINES 174-252

.. code-block:: Python


    from datetime import datetime, timedelta

    import cartopy.crs as ccrs
    import cartopy.feature as cfeature
    import matplotlib.patches as mpatches
    import matplotlib.pyplot as plt
    import numpy as np

    # Convert tracks from tensors to numpy arrays
    era5_paths = era5_tracks.numpy()
    sfno_paths = sfno_tracks.numpy()

    # Calculate end date
    end_time = start_time + timedelta(hours=6 * nsteps)

    # Create figure with cartopy projection
    plt.figure(figsize=(10, 8))
    projection = ccrs.LambertConformal(
        central_longitude=130.0, central_latitude=30.0, standard_parallels=(20.0, 40.0)
    )
    ax = plt.axes(projection=projection)

    # Add map features
    ax.add_feature(cfeature.COASTLINE)
    ax.add_feature(cfeature.LAND, alpha=0.1)
    ax.gridlines(draw_labels=True, alpha=0.6)
    ax.set_extent([90, 170, 0, 50], crs=ccrs.PlateCarree())

    era5_cmap = plt.cm.autumn
    sfno_cmap = plt.cm.winter

    for path in range(era5_paths.shape[1]):
        # Get lat/lon coordinates, filtering out nans
        lats = era5_paths[0, path, :, 0]
        lons = era5_paths[0, path, :, 1]
        mask = ~np.isnan(lats) & ~np.isnan(lons)
        if mask.any() and len(lons[mask]) > 2:
            color = era5_cmap(path / era5_paths.shape[1])
            ax.plot(
                lons[mask],
                lats[mask],
                color=color,
                linestyle="-.",
                marker="x",
                label="ERA5" if path == 0 else "",
                transform=ccrs.PlateCarree(),
            )

    for path in range(sfno_paths.shape[1]):
        # Get lat/lon coordinates, filtering out nans
        lats = sfno_paths[0, path, :, 0]
        lons = sfno_paths[0, path, :, 1]
        mask = ~np.isnan(lats) & ~np.isnan(lons)
        if mask.any() and len(lons[mask]) > 2:
            color = sfno_cmap(path / sfno_paths.shape[1])
            ax.plot(
                lons[mask],
                lats[mask],
                color=color,
                linestyle="-",
                label="SFNO" if path == 0 else "",
                transform=ccrs.PlateCarree(),
            )

    era5_patch = mpatches.Rectangle(
        (0, 0), 1, 1, fc=era5_cmap(0.3), alpha=0.9, label="ERA5"
    )
    sfno_patch = mpatches.Rectangle(
        (0, 0), 1, 1, fc=sfno_cmap(0.3), alpha=0.9, label="SFNO"
    )
    ax.legend(handles=[era5_patch, sfno_patch], loc="upper right", title="Cyclone Tracks")

    plt.title(
        f'Tropical Cyclone Tracks\n{start_time.strftime("%Y-%m-%d")} to {end_time.strftime("%Y-%m-%d")}'
    )
    plt.savefig(f"outputs/13_{start_time}_cyclone_tracks.jpg", bbox_inches="tight", dpi=300)




.. image-sg:: /examples/images/sphx_glr_13_cyclone_tracking_001.png
   :alt: Tropical Cyclone Tracks 2009-08-05 to 2009-08-09
   :srcset: /examples/images/sphx_glr_13_cyclone_tracking_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 253-259

In addition to filtering out the NaN values, users may want to apply other post
processing steps on the paths which may be enforcing path lengths are above a certain
threshold or other geography based filters.

No cyclone tracker is perfect, we encourage users to experiment and tune the tracker
as needed.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 46.789 seconds)


.. _sphx_glr_download_examples_13_cyclone_tracking.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 13_cyclone_tracking.ipynb <13_cyclone_tracking.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 13_cyclone_tracking.py <13_cyclone_tracking.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: 13_cyclone_tracking.zip <13_cyclone_tracking.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
